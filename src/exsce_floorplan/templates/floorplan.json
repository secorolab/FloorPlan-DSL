{% from './geometry.json' import point, frame, shape_points %}
{% import "./identifiers.json" as ids %}


{% macro space_macro(space) %}
    {{ point(ids.space_point_id(space)) }},
    {{ frame(ids.space_frame_id(space), ids.space_point_id(space)) }},
{%- endmacro -%}


{% macro wall_points(space) %}
    {% for wall in space.walls %}
    {% set outer_loop = loop %}
    {% set point_id = outer_loop.index0 %}
    {{ point(ids.wall_point_id(space, point_id)) }},
    {{ frame(ids.wall_frame_id(space, point_id), ids.wall_point_id(space, point_id)) }},
    {% for corner in [0, 1, 2, 3] %}
    {{ point(ids.wall_corner_point_id(space, point_id, corner)) }}
    {%- if not outer_loop.last or not loop.last %},
    {% endif %}
    {%- endfor %}
    {%- endfor %}
{%- endmacro -%}


{% macro polygon_walls(space) -%}
    {% for wall in space.walls %}
{
    {% set outer_loop = loop %}
    {% set wall_id = outer_loop.index0 %}
    "@id": "polytope:{{ ids.wall_polygon_id(space, wall_id) }}",
    "@type": "Polygon",
    "points": [
    {% for corner in [0, 1, 2, 3] %}
    "geom:{{ ids.wall_corner_point_id(space, wall_id, corner) }}"
    {%- if not loop.last %},
    {% endif %}
    {% endfor +%}
    ]
}{%- if not loop.last %},
    {% endif %}
{% endfor %}
{%- endmacro -%}

{% macro floor_features(space) -%}
    {% for feature in space.features %}
{
    "@id": "polytope:{{ ids.feature_polygon_id( space, feature) }}"
    "@type": "Polygon",
    "points": [
        {% for point in feature.get_points() %}
        "geom:{{ ids.feature_shape_point_id(feature.name, point) }}"
    {%- if not loop.last %},
    {% endif %}
        {% endfor +%}
    ]
}
{% endfor %}
{%- endmacro %}