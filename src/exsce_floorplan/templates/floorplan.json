{% from './geometry.json' import point, frame, shape_points %}

{% set POLYGON_ID = "polygon-{space_name}" %}
{% set POINT_SHAPE_ID = "point-shape-{space_name}-{point_id}" %}
{% set POLYGON_WALL_ID = "polygon-{space_name}-wall-{wall_id}" %}
{% set WALL_CORNER_ID = "point-corner-{space_name}-wall-{wall_id}-{corner_id}" %}

{% macro space_macro(name) %}
    {{ point("point-center-{}".format(name)) }},
    {{ frame("frame-center-{}".format(name), "point-center-{}".format(name)) }},
{%- endmacro -%}


{% macro wall_points(space) %}
    {% for wall in space.walls %}
    {% set outer_loop = loop %}
    {% set point_id = outer_loop.index0 %}
    {{ point("point-frame-{}-wall-{}".format(space.name, point_id)) }},
    {{ frame("frame-{}-wall-{}".format(space.name, point_id), "point-frame-{}-wall-{}".format(space.name, point_id)) }},
    {% for corner in [0, 1, 2, 3] %}
    {{ point("point-corner-{}-wall-{}-{}".format(space.name, point_id, corner)) }}
    {%- if not outer_loop.last or not loop.last %},
    {% endif %}
    {%- endfor %}
    {%- endfor %}
{%- endmacro -%}


{% macro polygon_walls(space) -%}
    {% for wall in space.walls %}
{
    {% set outer_loop = loop %}
    {% set point_id = outer_loop.index0 %}
    "@id": "polytope:polygon-{{ space.name }}-wall-{{ point_id }}",
    "@type": "Polygon",
    "points": [
    {% for corner in [0, 1, 2, 3] %}
    "geom:point-corner-{{space.name}}-wall-{{point_id}}-{{corner}}"
    {%- if not loop.last %},
    {% endif %}
    {% endfor +%}
    ]
}{%- if not loop.last %},
    {% endif %}
{% endfor %}
{%- endmacro -%}

{% macro floor_features(space) -%}
    {% for feature in space.features %}
{
    "@id": "polytope:polygon-{{ space.name }}-feature-{{ feature.name }}"
    "@type": "Polygon",
    "points": [
        {% for point in feature.get_points() %}
        "geom:point-feature-shape-{{ feature.name }}-{{ point }}"
    {%- if not loop.last %},
    {% endif %}
        {% endfor +%}
    ]
}
{% endfor %}
{%- endmacro %}