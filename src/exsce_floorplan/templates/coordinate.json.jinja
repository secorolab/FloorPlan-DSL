{% extends "./floorplan/floorplan.json" %}
{% import "./floorplan/identifiers.json" as ids %}
{% from "./geometry/spatial-relations.json" import to_ref_name, from_ref_name%}
{% from "./geometry/coordinate.json" import coord_frame_to_ref, pose_coord, wall_pose_frame_to_space_frame, shape_point_position_to_wall_frame %}


{% block context %}
        {
            "coord": "https://comp-rob2b.github.io/metamodels/geometry/coordinates#",
            "coordinate": "https://secorolab.github.io/metamodels/coordinates#",
            "geor": "https://comp-rob2b.github.io/metamodels/geometry/spatial-relations#",
            "geom": "https://comp-rob2b.github.io/metamodels/geometry/structural-entities#"
        },
        "https://comp-rob2b.github.io/metamodels/qudt.json",
        "https://comp-rob2b.github.io/metamodels/geometry/coordinates.json",
        "https://secorolab.github.io/metamodels/geometry/coordinate-extension.json"
{% endblock%}

{% block space %}
    {%- set to_f = to_ref_name(space.location.to_frame, space) %}
    {%- set from_f = from_ref_name(space.location.from_frame) %}
    {{ coord_frame_to_ref(space, to_f, from_f) }},
    {% for point in space.get_shape().get_points(wrt=space.get_shape().get_frame()) %}
    {{ pose_coord(space, point, loop.index0) }},
    {% endfor %}
{% endblock %}

{% block wall %}
{% set outer_loop = loop %}
{% set wall_id = outer_loop.index0 %}
{{ wall_pose_frame_to_space_frame(space, w, wall_id)}},
{% for p in w.polygon %}
{{ shape_point_position_to_wall_frame(space, wall_id, loop.index0, p) }}{% if not loop.last %},
    {% endif %}
{% endfor %}{% if not loop.last %},
    {% endif %}
{% endblock %}
