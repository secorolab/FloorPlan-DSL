{% extends "./floorplan/floorplan.json" %}
{% import "./floorplan/identifiers.json" as ids %}
{% from "./geometry/spatial-relations.json" import to_ref_name, from_ref_name, pose_from_to, polygon_position, wall_pose_to_space_ref_frame, wall_corner_to_wall_ref_frame %}


{% block context %}
        {
            "geor": "https://comp-rob2b.github.io/metamodels/geometry/spatial-relations#",
            "geom": "https://comp-rob2b.github.io/metamodels/geometry/structural-entities#"
        },
        "https://comp-rob2b.github.io/metamodels/geometry/spatial-relations.json"
{% endblock%}

{% block space %}
{# Pose of the spaces as specificied in the model #}
{%- set to_f = to_ref_name(space.location.to_frame, space) %}
{%- set from_f = from_ref_name(space.location.from_frame) %}
{{ pose_from_to( to_f, from_f) }},
{# Positions of the Polygons to the center frame #} 
{%- for pc in space.get_shape().get_points(wrt=space.get_shape().get_frame()) %}
    {{ polygon_position(loop.index0, space) }},
{% endfor %}
{% endblock %}

{% block wall %}
{# Pose of the wall frames with regards to the space frame #}
{% set outer_loop = loop %}
{{ wall_pose_to_space_ref_frame(space, outer_loop.index0)}},
{% for i in [0,1,2,3] %}
{{ wall_corner_to_wall_ref_frame(space, outer_loop.index0, i)}}{%- if not loop.last %},
    {% endif %}
{% endfor %}{% if not loop.last %},
    {% endif %}
{% endblock %}
